// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.

using Newtonsoft.Json;

namespace UpdateVulnerabilityData.CWE
{
    /// <summary>
    /// Generates a JSON-file containing a projection of the provided CSV source data.
    /// </summary>
    public static class CWEJsonFileExporter
    {
        /// <summary>
        /// Projects the provided CWE data from CSV-format to JSON.
        /// </summary>
        /// <param name="csvDocument">The CSV-document containing CWE source data.</param>
        /// <returns>A JSON-formatted string.</returns>
        public static string RenderJson(CWECsvDocument csvDocument)
        {
            var cweJsonDocument = new CWEJsonDocument();

            foreach (var entry in csvDocument.Entries)
            {
                var item = new CWEJsonDocumentEntry();
                item.ID = "CWE-" + entry.CWEID;

                // Strip off any surrounding quotes to avoid rendering them.
                if (entry.Description.StartsWith("\"") && entry.Description.EndsWith("\""))
                {
                    item.Description = entry.Description.Substring(1, entry.Description.Length - 2);
                }
                else
                {
                    item.Description = entry.Description;
                }

                item.Name = entry.Name;

                cweJsonDocument.Items.Add(item);
            }

            return JsonConvert.SerializeObject(cweJsonDocument, Formatting.None);
        }
    }
}
