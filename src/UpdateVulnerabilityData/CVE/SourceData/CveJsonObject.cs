// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.

using System.Diagnostics;
using Newtonsoft.Json;

namespace UpdateVulnerabilityData.CVE
{
    [DebuggerDisplay("{Id.Id}")]
    public class CveJsonObject
    {
        [JsonProperty(PropertyName = "data_type")]
        public string DataType { get; set; }

        [JsonProperty(PropertyName = "data_format")]
        public string DataFormat { get; set; }

        [JsonProperty(PropertyName = "data_version")]
        public string DataVersion { get; set; }

        [JsonProperty(PropertyName = "CVE_data_meta")]
        public CveIdJsonObject Id { get; set; }

        [JsonProperty(PropertyName = "description")]
        public CveDescriptionJsonObject Description { get; set; }

        [JsonProperty(PropertyName = "impact")]
        public CveImpactJsonObject Impact { get; set; }

        public decimal? GetCvssRating()
        {
            if (Impact == null)
            {
                return null;
            }
            else if (Impact.BaseMetricV3 != null)
            {
                // Prefer v3 metric if available.
                return Impact.BaseMetricV3.CvssV3?.BaseScore;
            }
            else if (Impact.BaseMetricV2 != null)
            {
                return Impact.BaseMetricV2.CvssV2?.BaseScore;
            }

            return null;
        }
    }
}